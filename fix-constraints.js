const { PrismaClient } = require("@prisma/client");

async function fixConstraints() {
  console.log("üîß Fixing database constraints...");

  const prisma = new PrismaClient();

  try {
    // Add unique constraint for CartItem cartId + productId
    console.log("Adding unique constraint for CartItem...");
    await prisma.$executeRawUnsafe(`
      ALTER TABLE "CartItem" 
      ADD CONSTRAINT "CartItem_cartId_productId_key" 
      UNIQUE ("cartId", "productId")
    `);
    console.log("‚úÖ CartItem unique constraint added");
  } catch (error) {
    if (error.message.includes("already exists")) {
      console.log("‚ö†Ô∏è  CartItem unique constraint already exists");
    } else {
      console.log("‚ùå Error adding CartItem constraint:", error.message);
    }
  } finally {
    await prisma.$disconnect();
  }
}

fixConstraints();

